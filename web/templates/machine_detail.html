{{define "machine-detail-content"}}
<section class="mb-24">
    <!-- Breadcrumbs and header -->
    <header class="pb-4 mb-8">
        <div class="font-medium space-x-2 mb-5 truncate flex">
            <a href="/" class="text-blue-400 hover:text-blue-300">All Machines</a>
            <span class="text-gray-500">/</span>
            <span class="text-gray-300">{{.Machine.PrimaryIP}}</span>
        </div>
        <div class="flex flex-wrap gap-2 items-center justify-between">
            <div class="flex gap-3 items-center">
                <h1 class="text-2xl font-semibold tracking-tight truncate flex-shrink-0 max-w-full">{{.Machine.Hostname}}</h1>
                <span class="inline-block w-2.5 h-2.5 rounded-full {{.Machine.StatusDotClass}} mt-[3px]"></span>
            </div>
        </div>

        <!-- Managed by / Status section -->
        <div class="flex border-t border-gray-700 text-sm mt-4 pt-4">
            <div class="max-w-sm">
                <div class="text-gray-400 mb-2">Managed by</div>
                <div class="mt-0.5">
                    <div class="flex items-center text-sm">
                        <span>{{.Machine.User}}</span>
                    </div>
                </div>
            </div>
            <div class="max-w-sm border-l border-gray-700 ml-4 pl-4">
                <p class="text-gray-400 mb-2">Status</p>
                <div class="flex gap-2 flex-wrap">
                    {{if .Machine.Online}}
                    <span class="inline-flex items-center px-2 py-1 rounded-sm text-xs bg-green-900 text-green-300 border border-green-700">Connected</span>
                    {{else}}
                    <span class="inline-flex items-center px-2 py-1 rounded-sm text-xs bg-gray-700 text-gray-300 border border-gray-600">Offline</span>
                    {{end}}
                    {{if .Machine.HasExitNode}}
                    <span class="inline-flex items-center px-2 py-1 rounded-sm text-xs bg-blue-900 text-blue-300 border border-blue-700">Exit Node</span>
                    {{else if .Machine.HasSubnetRoutes}}
                    <span class="inline-flex items-center px-2 py-1 rounded-sm text-xs bg-blue-900 text-blue-300 border border-blue-700">Subnets</span>
                    {{end}}
                    {{range .Machine.Tags}}
                    <span class="inline-flex items-center px-2 py-1 rounded-sm text-xs bg-gray-700 text-gray-300 border border-gray-600">{{.}}</span>
                    {{end}}
                </div>
            </div>
        </div>
    </header>

    <!-- Subnets Section -->
    <section class="mb-8">
        <header class="max-w-xl mb-4">
            <h3 class="text-xl font-semibold tracking-tight mb-2">Subnets</h3>
            <p class="text-gray-400">Subnets let you expose physical network routes onto Tailscale. <a href="#" class="text-blue-400 hover:text-blue-300">Learn more</a></p>
        </header>
        {{if .Machine.HasSubnetRoutes}}
        <div class="p-4 md:p-6 border border-gray-700 bg-gray-800 rounded-md grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Approved Subnets -->
            <div>
                <h4 class="text-sm font-semibold mb-3 flex items-center gap-2">
                    Approved
                    <svg class="w-4 h-4 text-gray-400 info-icon" fill="currentColor" viewBox="0 0 20 20" title="These routes are approved and active">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                    </svg>
                </h4>
                {{$approvedRoutes := .Machine.ApprovedSubnets}}
                {{if $approvedRoutes}}
                <div class="space-y-2">
                    {{range $approvedRoutes}}
                    <div class="flex items-center justify-between gap-2">
                        <span class="text-sm font-mono">{{.}}</span>
                        <form method="POST" action="/machines/{{$.Machine.ID}}/routes/subnets/reject" class="inline">
                            <input type="hidden" name="route" value="{{.}}">
                            <button type="submit" class="px-2 py-0.5 text-xs rounded bg-gray-700 hover:bg-gray-600 border border-gray-600 text-gray-200">
                                Reject
                            </button>
                        </form>
                    </div>
                    {{end}}
                </div>
                {{else}}
                <div class="text-sm text-gray-400">—</div>
                {{end}}
            </div>

            <!-- Awaiting Approval -->
            <div>
                <h4 class="text-sm font-semibold mb-3 flex items-center gap-2">
                    Awaiting Approval
                    <svg class="w-4 h-4 text-gray-400 info-icon" fill="currentColor" viewBox="0 0 20 20" title="These routes are advertised but not yet approved">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                    </svg>
                </h4>
                {{$pendingRoutes := .Machine.AdvertisedSubnets}}
                {{if $pendingRoutes}}
                <div class="space-y-2">
                    {{range $pendingRoutes}}
                    <div class="flex items-center justify-between gap-2">
                        <span class="text-sm font-mono">{{.}}</span>
                        <div class="flex gap-1">
                            <form method="POST" action="/machines/{{$.Machine.ID}}/routes/subnets/approve" class="inline">
                                <input type="hidden" name="route" value="{{.}}">
                                <button type="submit" class="px-2 py-0.5 text-xs rounded bg-green-700 hover:bg-green-600 border border-green-600 text-white">
                                    Approve
                                </button>
                            </form>
                            <form method="POST" action="/machines/{{$.Machine.ID}}/routes/subnets/reject" class="inline">
                                <input type="hidden" name="route" value="{{.}}">
                                <button type="submit" class="px-2 py-0.5 text-xs rounded bg-gray-700 hover:bg-gray-600 border border-gray-600 text-gray-200">
                                    Reject
                                </button>
                            </form>
                        </div>
                    </div>
                    {{end}}
                </div>
                {{else}}
                <div class="text-sm text-gray-400">—</div>
                {{end}}
            </div>
        </div>
        {{else}}
        <div class="p-8 border border-gray-700 bg-gray-800 rounded-md text-center text-gray-400">
            This machine does not expose any routes.
        </div>
        {{end}}
    </section>

    <!-- Routing Settings Section -->
    {{if .Machine.HasExitNode}}
    <section class="mb-8">
        <header class="max-w-xl mb-4">
            <h3 class="text-xl font-semibold tracking-tight mb-2">Routing Settings</h3>
            <p class="text-gray-400">Let this device route traffic for your tailnet. <a href="#" class="text-blue-400 hover:text-blue-300">Learn more</a></p>
        </header>
        <div class="p-4 md:p-6 border border-gray-700 bg-gray-800 rounded-md grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Exit Node -->
            <div>
                <h4 class="text-sm mb-3 flex items-center gap-2">
                    Exit Node
                    <svg class="w-4 h-4 text-gray-400 info-icon" fill="currentColor" viewBox="0 0 20 20" title="Exit node allows routing internet traffic through this machine">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                    </svg>
                </h4>
                {{if .Machine.ExitNodeApproved}}
                <div class="flex items-center gap-2 text-sm mb-3">
                    <svg class="w-4 h-4 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    <span class="text-green-600 font-medium">Allowed</span>
                </div>
                <form method="POST" action="/machines/{{.Machine.ID}}/routes/exit-node/reject">
                    <button type="submit" class="px-3 py-1.5 text-sm rounded bg-gray-700 hover:bg-gray-600 border border-gray-600 text-gray-200">
                        Reject
                    </button>
                </form>
                {{else if .Machine.ExitNodeAdvertised}}
                <div class="flex items-center gap-2 text-sm mb-3">
                    <svg class="w-4 h-4 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                    </svg>
                    <span class="text-gray-400">Awaiting approval</span>
                </div>
                <div class="flex gap-2">
                    <form method="POST" action="/machines/{{.Machine.ID}}/routes/exit-node/approve">
                        <button type="submit" class="px-3 py-1.5 text-sm rounded bg-green-700 hover:bg-green-600 border border-green-600 text-white">
                            Approve
                        </button>
                    </form>
                    <form method="POST" action="/machines/{{.Machine.ID}}/routes/exit-node/reject">
                        <button type="submit" class="px-3 py-1.5 text-sm rounded bg-gray-700 hover:bg-gray-600 border border-gray-600 text-gray-200">
                            Reject
                        </button>
                    </form>
                </div>
                {{end}}
            </div>

            <!-- Apps -->
            <div>
                <h4 class="text-sm mb-3 flex items-center gap-2">
                    Apps
                    <svg class="w-4 h-4 text-gray-400 info-icon" fill="currentColor" viewBox="0 0 20 20" title="App connector settings">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                    </svg>
                </h4>
                <div class="text-sm text-gray-400">—</div>
            </div>
        </div>
    </section>
    {{end}}

    <!-- Machine Details Section -->
    <section class="mb-8">
        <header class="max-w-xl mb-4">
            <h3 class="text-xl font-semibold tracking-tight mb-2">Machine Details</h3>
            <p class="text-gray-400">Information about this machine's network. Used to debug connection issues.</p>
        </header>
        <div class="p-4 md:p-6 border border-gray-700 bg-gray-800 rounded-md grid grid-cols-1 lg:grid-cols-2 gap-y-2 sm:gap-x-12">
            <!-- Left column -->
            <div class="flex flex-col gap-2">
                <dl class="flex gap-1 text-sm">
                    <dt class="text-gray-400 w-1/3 sm:w-1/4 lg:w-1/3 shrink-0 min-w-0 truncate">Creator</dt>
                    <dd class="min-w-0 truncate">{{.Machine.User}}</dd>
                </dl>
                <dl class="flex gap-1 text-sm">
                    <dt class="text-gray-400 w-1/3 sm:w-1/4 lg:w-1/3 shrink-0 min-w-0 truncate">Machine name</dt>
                    <dd class="min-w-0 truncate flex items-center gap-2">
                        <span>{{.Machine.Hostname}}</span>
                        <button onclick="copyToClipboard({{.Machine.Hostname | js}}, this)" class="copy-btn inline-flex items-center" title="Copy">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect width="13" height="13" x="9" y="9" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                        </button>
                    </dd>
                </dl>
                <dl class="flex gap-1 text-sm">
                    <dt class="text-gray-400 w-1/3 sm:w-1/4 lg:w-1/3 shrink-0 min-w-0 truncate">OS hostname</dt>
                    <dd class="min-w-0 truncate">{{.Machine.OSHostname}}</dd>
                </dl>
                <dl class="flex gap-1 text-sm">
                    <dt class="text-gray-400 w-1/3 sm:w-1/4 lg:w-1/3 shrink-0 min-w-0 truncate">OS</dt>
                    <dd class="min-w-0 truncate">{{.Machine.OS}}</dd>
                </dl>
                <dl class="flex gap-1 text-sm">
                    <dt class="text-gray-400 w-1/3 sm:w-1/4 lg:w-1/3 shrink-0 min-w-0 truncate">Tailscale version</dt>
                    <dd class="min-w-0 truncate" data-ts-version>{{.Machine.TailscaleVersion}}</dd>
                </dl>
                <dl class="flex gap-1 text-sm">
                    <dt class="text-gray-400 w-1/3 sm:w-1/4 lg:w-1/3 shrink-0 min-w-0 truncate">ID</dt>
                    <dd class="min-w-0 truncate flex items-center gap-2">
                        <span>{{.Machine.ID}}</span>
                        <button onclick="copyToClipboard({{printf "%d" .Machine.ID | js}}, this)" class="copy-btn inline-flex items-center" title="Copy">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect width="13" height="13" x="9" y="9" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                        </button>
                    </dd>
                </dl>
                <dl class="flex gap-1 text-sm">
                    <dt class="text-gray-400 w-1/3 sm:w-1/4 lg:w-1/3 shrink-0 min-w-0 truncate">Node key</dt>
                    <dd class="min-w-0 truncate flex items-center gap-2">
                        <span class="font-mono text-xs" title="{{.Machine.NodeKey}}">{{.Machine.NodeKeyShort}}</span>
                        <button onclick="copyToClipboard({{.Machine.NodeKey | js}}, this)" class="copy-btn inline-flex items-center" title="Copy">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect width="13" height="13" x="9" y="9" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                        </button>
                    </dd>
                </dl>
                <dl class="flex gap-1 text-sm">
                    <dt class="text-gray-400 w-1/3 sm:w-1/4 lg:w-1/3 shrink-0 min-w-0 truncate">Created</dt>
                    <dd class="min-w-0 truncate">{{.Machine.Created}}</dd>
                </dl>
                <dl class="flex gap-1 text-sm">
                    <dt class="text-gray-400 w-1/3 sm:w-1/4 lg:w-1/3 shrink-0 min-w-0 truncate">Last seen</dt>
                    <dd class="min-w-0 truncate">
                        {{if .Machine.Online}}
                        <span><span class="inline-block w-2 h-2 rounded-full bg-green-300 mr-2"></span>Connected</span>
                        {{else}}
                        <span title="{{.Machine.LastSeenFull}}">{{.Machine.LastSeenShort}}</span>
                        {{end}}
                    </dd>
                </dl>
                <dl class="flex gap-1 text-sm">
                    <dt class="text-gray-400 w-1/3 sm:w-1/4 lg:w-1/3 shrink-0 min-w-0 truncate">Key expiry</dt>
                    <dd class="min-w-0 truncate">{{.Machine.KeyExpiry}}</dd>
                </dl>

                {{if .Machine.Tags}}
                <!-- Tags -->
                <h3 class="first:mt-0 mt-4 mb-2 text-xs uppercase font-semibold text-gray-400 tracking-wide">Tags</h3>
                {{range .Machine.Tags}}
                <dl class="flex gap-1 text-sm">
                    <dd class="min-w-0 truncate">{{.}}</dd>
                </dl>
                {{end}}
                {{end}}

                <!-- ATTRIBUTES -->
                <h3 class="first:mt-0 mt-4 mb-2 text-xs uppercase font-semibold text-gray-400 tracking-wide">Attributes</h3>
                <dl class="flex gap-1 text-sm">
                    <dt class="text-gray-400 w-1/3 sm:w-1/4 lg:w-1/3 shrink-0 min-w-0 truncate">node:os</dt>
                    <dd class="min-w-0 truncate">{{.Machine.OS}}</dd>
                </dl>
                <dl class="flex gap-1 text-sm">
                    <dt class="text-gray-400 w-1/3 sm:w-1/4 lg:w-1/3 shrink-0 min-w-0 truncate">node:osVersion</dt>
                    <dd class="min-w-0 truncate" data-os-version>{{.Machine.OSVersion}}</dd>
                </dl>
                <dl class="flex gap-1 text-sm">
                    <dt class="text-gray-400 w-1/3 sm:w-1/4 lg:w-1/3 shrink-0 min-w-0 truncate">node:tsAutoUpdate</dt>
                    <dd class="min-w-0 truncate">{{.Machine.AutoUpdate}}</dd>
                </dl>
                <dl class="flex gap-1 text-sm">
                    <dt class="text-gray-400 w-1/3 sm:w-1/4 lg:w-1/3 shrink-0 min-w-0 truncate">node:tsReleaseTrack</dt>
                    <dd class="min-w-0 truncate">{{.Machine.ReleaseTrack}}</dd>
                </dl>
                <dl class="flex gap-1 text-sm">
                    <dt class="text-gray-400 w-1/3 sm:w-1/4 lg:w-1/3 shrink-0 min-w-0 truncate">node:tsStateEncrypted</dt>
                    <dd class="min-w-0 truncate">{{.Machine.StateEncrypted}}</dd>
                </dl>
                <dl class="flex gap-1 text-sm">
                    <dt class="text-gray-400 w-1/3 sm:w-1/4 lg:w-1/3 shrink-0 min-w-0 truncate">node:tsVersion</dt>
                    <dd class="min-w-0 truncate" data-ts-version>{{.Machine.TailscaleVersion}}</dd>
                </dl>

                <!-- DERP Latency -->
                {{if .DERPLatencies}}
                <h3 class="first:mt-0 mt-4 mb-2 text-xs uppercase font-semibold text-gray-400 tracking-wide">Relays</h3>
                <dl class="flex gap-1 text-sm">
                    <dt class="text-gray-400 w-1/3 sm:w-1/4 lg:w-1/3 shrink-0 min-w-0 truncate">Latency</dt>
                    <dd class="min-w-0">
                        <ul>
                            {{range .DERPLatencies}}
                            <li class="whitespace-nowrap">
                                <strong class="font-medium">{{.RegionName}}</strong>: {{printf "%.1f" .LatencyMS}} ms
                                {{if .Preferred}}<span class="text-xs text-green-600 ml-1">(preferred)</span>{{end}}
                            </li>
                            {{end}}
                        </ul>
                    </dd>
                </dl>
                {{end}}
            </div>

            <!-- Right column -->
            <div class="flex flex-col gap-2">
                <h3 class="first:mt-0 mt-0 mb-2 text-xs uppercase font-semibold text-gray-400 tracking-wide">Addresses</h3>
                {{range .Machine.TailscaleIPs}}
                <dl class="flex gap-1 text-sm">
                    <dt class="text-gray-400 w-1/3 sm:w-1/4 lg:w-1/3 shrink-0 min-w-0 truncate">Tailscale IP</dt>
                    <dd class="min-w-0 truncate flex items-center gap-2">
                        <span class="font-mono text-sm">{{.}}</span>
                        <button onclick="copyToClipboard({{. | js}}, this)" class="copy-btn inline-flex items-center" title="Copy">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect width="13" height="13" x="9" y="9" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                        </button>
                    </dd>
                </dl>
                {{end}}

                <dl class="flex gap-1 text-sm">
                    <dt class="text-gray-400 w-1/3 sm:w-1/4 lg:w-1/3 shrink-0 min-w-0 truncate">Short domain</dt>
                    <dd class="min-w-0 truncate flex items-center gap-2">
                        <span>{{.Machine.ShortDomain}}</span>
                        <button onclick="copyToClipboard({{.Machine.ShortDomain | js}}, this)" class="copy-btn inline-flex items-center" title="Copy">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect width="13" height="13" x="9" y="9" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                        </button>
                    </dd>
                </dl>
                <dl class="flex gap-1 text-sm">
                    <dt class="text-gray-400 w-1/3 sm:w-1/4 lg:w-1/3 shrink-0 min-w-0 truncate">Full domain</dt>
                    <dd class="min-w-0 truncate flex items-center gap-2">
                        <span>{{.Machine.FullDomain}}</span>
                        <button onclick="copyToClipboard({{.Machine.FullDomain | js}}, this)" class="copy-btn inline-flex items-center" title="Copy">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect width="13" height="13" x="9" y="9" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                        </button>
                    </dd>
                </dl>

                {{if .Machine.Endpoints}}
                <dl class="flex gap-1 text-sm">
                    <dt class="text-gray-400 w-1/3 sm:w-1/4 lg:w-1/3 shrink-0 min-w-0 truncate">Endpoints</dt>
                    <dd class="min-w-0">
                        {{range .Machine.Endpoints}}
                        <div class="font-mono text-xs">{{.}}</div>
                        {{end}}
                    </dd>
                </dl>
                {{end}}

                <!-- CLIENT CONNECTIVITY -->
                {{$connectivity := .Machine.ClientConnectivity}}
                {{if $connectivity}}
                <h3 class="first:mt-0 mt-4 mb-2 text-xs uppercase font-semibold text-gray-400 tracking-wide">Client Connectivity</h3>
                {{if index $connectivity "Varies"}}
                <dl class="flex gap-1 text-sm">
                    <dt class="text-gray-400 w-1/3 sm:w-1/4 lg:w-1/3 shrink-0 min-w-0 truncate">Varies</dt>
                    <dd class="min-w-0 truncate">{{index $connectivity "Varies"}}</dd>
                </dl>
                {{end}}
                {{if index $connectivity "IPv6"}}
                <dl class="flex gap-1 text-sm">
                    <dt class="text-gray-400 w-1/3 sm:w-1/4 lg:w-1/3 shrink-0 min-w-0 truncate">IPv6</dt>
                    <dd class="min-w-0 truncate">{{index $connectivity "IPv6"}}</dd>
                </dl>
                {{end}}
                {{if index $connectivity "UDP"}}
                <dl class="flex gap-1 text-sm">
                    <dt class="text-gray-400 w-1/3 sm:w-1/4 lg:w-1/3 shrink-0 min-w-0 truncate">UDP</dt>
                    <dd class="min-w-0 truncate">{{index $connectivity "UDP"}}</dd>
                </dl>
                {{end}}
                {{if index $connectivity "UPnP"}}
                <dl class="flex gap-1 text-sm">
                    <dt class="text-gray-400 w-1/3 sm:w-1/4 lg:w-1/3 shrink-0 min-w-0 truncate">UPnP</dt>
                    <dd class="min-w-0 truncate">{{index $connectivity "UPnP"}}</dd>
                </dl>
                {{end}}
                {{if index $connectivity "PCP"}}
                <dl class="flex gap-1 text-sm">
                    <dt class="text-gray-400 w-1/3 sm:w-1/4 lg:w-1/3 shrink-0 min-w-0 truncate">PCP</dt>
                    <dd class="min-w-0 truncate">{{index $connectivity "PCP"}}</dd>
                </dl>
                {{end}}
                {{if index $connectivity "NAT-PMP"}}
                <dl class="flex gap-1 text-sm">
                    <dt class="text-gray-400 w-1/3 sm:w-1/4 lg:w-1/3 shrink-0 min-w-0 truncate">NAT-PMP</dt>
                    <dd class="min-w-0 truncate">{{index $connectivity "NAT-PMP"}}</dd>
                </dl>
                {{end}}
                {{end}}
            </div>
        </div>
    </section>
</section>
{{end}}

{{define "machine_detail.html"}}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Machine.Hostname}} - Headscale Admin</title>
    <script src="/static/js/tailwind-3.4.17.js"></script>
    <script src="/static/js/htmx-1.9.10.min.js"></script>
    <script src="/static/js/htmx-sse-1.9.10.js"></script>
    {{template "layout-styles"}}
    <style>
        .copy-btn {
            cursor: pointer;
            color: #9ca3af;
            transition: color 0.15s;
        }
        .copy-btn:hover {
            color: #d1d5db;
        }
        .info-icon {
            color: #6b7280;
            cursor: help;
        }
    </style>
    <script>
        function copyToClipboard(text, btn) {
            navigator.clipboard.writeText(text).then(() => {
                const originalHTML = btn.innerHTML;
                btn.innerHTML = '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/><path d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm9.707 5.707a1 1 0 00-1.414-1.414L9 12.586l-1.293-1.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/></svg>';
                setTimeout(() => {
                    btn.innerHTML = originalHTML;
                }, 1500);
            });
        }
    </script>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen" hx-ext="sse" sse-connect="/events">
    {{template "layout-header" .}}
    <main class="container mx-auto pb-20 md:pb-24">
        {{template "machine-detail-content" .}}
    </main>
</body>
</html>
{{end}}
